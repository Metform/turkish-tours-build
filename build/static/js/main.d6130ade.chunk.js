(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{108:function(e,t,a){},109:function(e,t,a){},110:function(e,t,a){},111:function(e,t,a){},123:function(e,t,a){},124:function(e,t,a){},127:function(e,t,a){},128:function(e,t,a){},129:function(e,t,a){},130:function(e,t,a){},131:function(e,t,a){},153:function(e,t,a){},154:function(e,t,a){},155:function(e,t,a){},156:function(e,t,a){},158:function(e,t,a){},171:function(e,t,a){},172:function(e,t,a){},173:function(e,t,a){},174:function(e,t,a){},175:function(e,t,a){},176:function(e,t,a){},177:function(e,t,a){},178:function(e,t,a){},179:function(e,t,a){},180:function(e,t,a){},181:function(e,t,a){},182:function(e,t,a){},183:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(45),i=a.n(r),s=(a(94),a(4)),l=a(5),c=a(7),u=a(6),m=a(8),d=a(29),p=a(198),h=a(202),f=a(197),E=a(203),g=a(41),v=a.n(g),b=o.a.createContext({token:void 0,userId:null,isAdmin:!1,hostname:null,stripe_pub_key:null,login:function(){},logout:function(){console.log("logout!")}}),y=(a(95),function(e){return o.a.createElement(b.Consumer,null,function(e){return o.a.createElement("header",{className:"main-navigation"},o.a.createElement("div",{className:"main-navigation__logo"},o.a.createElement("h1",null,"Turkey Tours")),o.a.createElement("nav",{className:"main-navigation__items"},o.a.createElement("ul",null,!e.token&&o.a.createElement("li",null,o.a.createElement(v.a,{to:"/auth"},"Authenticate")),o.a.createElement("li",null,o.a.createElement(v.a,{to:"/events"},"Tours")),e.token&&o.a.createElement(o.a.Fragment,null,o.a.createElement("li",null,o.a.createElement(v.a,{to:"/bookings"},"Bookings")),o.a.createElement("li",null,o.a.createElement("button",{onClick:e.logout},"Logout"))))))})}),k=a(23),S=a(36),C=a(185),w=a(195),_=(a(108),a(19)),N=a.n(_),x=(a(109),function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={isHide:!1},a.timer=null,a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=2|this.props.duration;this.timer=setTimeout(function(){e.setState({isHide:!0}),e.props.onClose&&e.props.onClose()},1e3*t)}},{key:"componentWillUnmount",value:function(){clearTimeout(this.timer)}},{key:"render",value:function(){return o.a.createElement(o.a.Fragment,null,!this.state.isHide&&o.a.createElement("div",{className:N()({notify__container:!0,warning:this.props.warning,success:!this.props.error,error:this.props.error})},o.a.createElement("div",null,this.props.text)))}}]),t}(n.Component)),I={email:new RegExp('^(([^<>()[\\]\\\\.,;:\\s@\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\"]+)*)|(\\".+\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$'),password:"^(?=.)(?=.*[a-z])(?=.*[A-Z])(?=.*[a-zA-Z]).{8,}$"},O=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={isLogin:!0,isPendingConfirmation:!1,isConfirmed:!1,isSuccess:!1,popupMessage:""},a.switchModeHandler=function(){a.resetInvalidFields(),a.setState(function(e){return{isLogin:!e.isLogin}})},a.submitHandler=function(e){e.preventDefault();var t=a.passwordEl.current.value,n=a.phoneNumberEl.current.value;if(0!==t.trim().length&&0!==n.trim().length){var o={query:"\n                mutation Login($LoginInput: LoginInput!){\n                    login(input: $LoginInput) {\n                        idToken\n                    }\n                }\n            ",variables:{LoginInput:{phoneNumber:n,password:t}}};if(!a.state.isLogin&&!a.state.isPendingConfirmation)o={query:"\n                mutation Signup($SignupInput: SignupInput!){\n                    signup(input: $SignupInput) {\n                        username\n                    }\n                }",variables:{SignupInput:{phoneNumber:n,password:t,name:a.emailEl.current.value}}};if(!a.state.isLogin&&!a.state.isConfirmed&&a.state.isPendingConfirmation)o={query:"\n                    mutation SignupConfirm($SignupConfirmInput: SignupConfirmInput!) {\n                        signupConfirm(input: $SignupConfirmInput)\n                    }\n                ",variables:{SignupConfirmInput:{phoneNumber:n,confirmationCode:a.confirmationCodeEl.current.value}}};fetch("".concat(a.context.hostname,"/graphql"),{method:"POST",body:JSON.stringify(o),headers:{Accept:"application/json","Content-Type":"application/json",Cookie:"".concat(document.cookie)},credentials:"include"}).then(function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()}).then(function(e){var t=Object(S.a)(["data","login","idToken"],e),n=Object(C.a)(Object(w.a)(["errors",0,"message"]),e);if(a.state.isLogin&&!e.data.login&&n&&a.setInvalidFields(n),n)return console.log(n),void a.setState({isSuccess:!1,popupMessage:n});a.state.isLogin||a.state.isConfirmed||!e.data.signup||a.setState({isPendingConfirmation:!0}),a.state.isLogin&&t&&a.context.login(t),e.data.signupConfirm&&a.setState({isSuccess:!0,isConfirmed:!0,popupMessage:"You are successfully signed up"})}).catch(function(e){throw Error(e)})}},a.setInvalidFields=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Invalid data";document.getElementById("loginErrorMsg")&&document.getElementById("loginErrorMsg").remove();var t=document.createElement("p");t.innerText=e,t.style.color="red",t.id="loginErrorMsg",a.phoneNumberEl.current&&a.phoneNumberEl.current.parentElement.classList.add("invalid_auth"),a.passwordEl.current&&a.passwordEl.current.parentElement.classList.add("invalid_auth"),a.passwordEl.current&&a.passwordEl.current.parentElement.parentElement.insertBefore(t,a.passwordEl.current.parentElement.nextSibling)},a.resetInvalidFields=function(){a.phoneNumberEl.current&&a.phoneNumberEl.current.parentElement.classList.remove("invalid_auth"),a.passwordEl.current&&a.passwordEl.current.parentElement.classList.remove("invalid_auth"),document.getElementById("loginErrorMsg")&&document.getElementById("loginErrorMsg").remove()},a.emailInputHandle=function(e){e.target.parentElement.classList.toggle("email__success",I.email.test(a.emailEl.current.value))},a.emailEl=o.a.createRef(),a.passwordEl=o.a.createRef(),a.phoneNumberEl=o.a.createRef(),a.confirmationCodeEl=o.a.createRef(),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"renderConfirmationForm",value:function(){return o.a.createElement("div",{className:"email"},o.a.createElement("input",{type:"number",id:"confirmationCode",name:"confirmationCode",placeholder:"code",ref:this.confirmationCodeEl,required:!0}))}},{key:"renderSignupForm",value:function(){var e=this;return o.a.createElement("form",{className:"auth-form",onSubmit:this.submitHandler},o.a.createElement("div",{className:"email"},o.a.createElement("input",{type:"text",id:"phone",name:"phone",placeholder:"tel",ref:this.phoneNumberEl,pattern:"^\\s*(?:\\+?(\\d{1,3}))?([-. (]*(\\d{3})[-. )]*)?((\\d{3})[-. ]*(\\d{2,4})(?:[-.x ]*(\\d+))?)\\s*$",title:"Invalid phone number try again",required:!0})),o.a.createElement("div",{className:"email"},o.a.createElement("input",{type:"text",placeholder:"test@test.com",ref:this.emailEl,onChange:this.emailInputHandle,pattern:"[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?",title:"Invalid email please try better"}),o.a.createElement("svg",{viewBox:"0 0 16 16"},o.a.createElement("path",{d:"M10.8000002,10.8000002 C9.85000038,11.6500006 9.18349609,12 8,12 C5.80000019,12 4,10.1999998 4,8 C4,5.80000019 5.80000019,4 8,4 C10.1999998,4 12,6 12,8 C12,9.35332031 12.75,9.5 13.5,9.5 C14.25,9.5 15,8.60000038 15,8 C15,4 12,1 8,1 C4,1 1,4 1,8 C1,12 4,15 8,15 C12,15 15,12 15,8"}),o.a.createElement("polyline",{points:"5 8.375 7.59090909 11 14.5 4",transform:"translate(0 -0.5)"})),o.a.createElement("a",{className:"dribbble",href:" +",target:"_blank"},o.a.createElement("img",{src:"https://cdn.dribbble.com/assets/dribbble-ball-1col-dnld-e29e0436f93d2f9c430fde5f3da66f94493fdca66351408ab0f96e2ec518ab17.png",alt:""}))),o.a.createElement("div",{className:"email"},o.a.createElement("input",{type:"password",placeholder:"passwod",ref:this.passwordEl,pattern:"^(?=.*\\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[a-zA-Z]).{8,}$",autoComplete:"off",required:!0,title:"Enter an password consisting of 8+ symbols with at least one uppercase and lowercase letter"})),this.state.isPendingConfirmation&&this.renderConfirmationForm(),this.state.popupMessage&&this.state.isSuccess&&o.a.createElement(x,{error:!this.state.isSuccess,text:this.state.popupMessage,onClose:function(){e.setState({popupMessage:""})}}),this.state.popupMessage&&!this.state.isSuccess&&o.a.createElement(x,{error:!this.state.isSuccess,text:this.state.popupMessage,onClose:function(){e.setState({popupMessage:""})}}),o.a.createElement("div",{className:"form-action"},o.a.createElement("button",{type:"submit"},this.state.isPendingConfirmation?"Submit":"Confirm"),o.a.createElement("button",{type:"button",onClick:this.switchModeHandler},this.state.isLogin?"Sign Up":"Login")))}},{key:"renderLoginForm",value:function(){return o.a.createElement("form",{className:"auth-form",onSubmit:this.submitHandler},o.a.createElement("div",{className:"email"},o.a.createElement("input",{type:"text",id:"phone",name:"phone",placeholder:"tel",ref:this.phoneNumberEl,pattern:"^\\s*(?:\\+?(\\d{1,3}))?([-. (]*(\\d{3})[-. )]*)?((\\d{3})[-. ]*(\\d{2,4})(?:[-.x ]*(\\d+))?)\\s*$",title:"Invalid phone number try again",required:!0})),o.a.createElement("div",{className:"email"},o.a.createElement("input",{type:"password",placeholder:"passwod",ref:this.passwordEl,pattern:"^(?=.*\\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[a-zA-Z]).{8,}$",autoComplete:"off",required:!0,title:"Enter an password consisting of 8+ symbols with at least one uppercase and lowercase letter"})),o.a.createElement("div",{className:"form-action"},o.a.createElement("button",{type:"submit"},"Submit"),o.a.createElement("button",{type:"button",onClick:this.switchModeHandler},this.state.isLogin?"Sign Up":"Login")))}},{key:"render",value:function(){return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"auth-container"},o.a.createElement("div",{className:"auth-control"},o.a.createElement("div",{className:"header"},this.state.isLogin?"Login":"Sign Up"),this.state.isLogin?this.renderLoginForm():this.renderSignupForm())))}}]),t}(n.Component);O.contextType=b;var j=O,R=a(24),M=(a(110),function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{className:"backdrop"})}}]),t}(n.Component)),F=(a(111),function(e){return o.a.createElement("div",{className:"spinner",style:e.style},o.a.createElement("div",{className:"lds-ripple"},o.a.createElement("div",null),o.a.createElement("div",null)))}),L=a(26),P=a(47),A=a(1),T=a.n(A),D=a(22),B=a(200),U=a(206),q=a(187),H=a(207),z=a(201),$=(a(112),a(65)),G=a(79),V=a(186),J=(a(123),new G.GeocodeService),K=new T.a.Icon({iconUrl:a(52),iconRetinaUrl:a(52),iconAnchor:[-5,35],popupAnchor:[25,-17],iconSize:[25,55],shadowSize:[68,95],shadowAnchor:[20,92]});var W=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(l.a)(t,[{key:"onShowLocation",value:function(e){var t,a=(t=e.location.bounds[0],new Promise(function(e,a){J.reverse().latlng(t).run(function(t,n){return t?a(t):e(n)})}));this.props.getUserHotelLocation&&this.props.getUserHotelLocation({label:e.location.label,coords:e.location.bounds[0],fullLocationInfo:a})}},{key:"createLeafletElement",value:function(){return this.props.leaflet.map.on("geosearch/showlocation",this.onShowLocation.bind(this)),Object($.GeoSearchControl)({provider:new $.EsriProvider,style:"bar",maxMarkers:2,marker:{icon:K,draggable:!1},autoComplete:!0,popupFormat:function(e){e.query;return e.result.label},autoClose:!0,keepResult:!0,showPopup:!0,showMarker:!0})}}]),t}(V.a),Z=(a(124),Object(D.b)(W)),Y=new T.a.Icon({iconUrl:a(70),iconRetinaUrl:a(70),iconAnchor:[13,41],popupAnchor:[15,-24],iconSize:[25,55],shadowSize:[68,95],shadowAnchor:[20,92]}),Q=new T.a.Icon({iconUrl:a(52),iconRetinaUrl:a(52),iconAnchor:[13,41],popupAnchor:[15,-24],iconSize:[25,55],shadowSize:[68,95],shadowAnchor:[20,92]}),X=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).abortController=new AbortController,a.formSubmitted=function(e){e.preventDefault(),a.setState(function(e){var t=Object(R.a)(e.geos);return console.log(t),t.push(Object(d.a)({coords:a.state.latlng},a.state.userMessage)),{geos:t}},function(){return a.props.onFormSubmit(a.state.geos)})},a.handleClick=function(e){a.props.enableSearch||a.setState({latlng:[e.latlng.lat,e.latlng.lng]})},a.onMarkerClearAll=function(){a.setState({geos:[]})},a.onMarkerUpdate=function(){a.setState(function(e){return{geos:e.geos.map(function(e){return e.coords[0]===a.state.selectedMarker.coords[0]&&e.coords[1]===a.state.selectedMarker.coords[1]&&(e.name=a.markerNameRef.current.value,e.message=a.markerMessageRef.current.value),e})}})},a.onMarkerRemove=function(){a.setState(function(e){return{geos:e.geos.filter(function(e){return e.coords[0]!==a.state.selectedMarker.coords[0]&&e.coords[1]!==a.state.selectedMarker.coords[1]&&e})}})},a.onMarkerClick=function(e){var t=e.latlng,n=t.lat,o=t.lng,r=a.state.geos.find(function(e){return e.coords[0]===n&&e.coords[1]===o});a.markerNameRef.current.value=r.name,a.markerMessageRef.current.value=r.message,a.setState({selectedMarker:r})},a.props=e,a.state={location:{lat:0,lng:0},haveUsersLocation:!1,zoom:1|a.props.zoom,userMessage:{name:"",message:""},geos:[],latlng:[],selectedMarker:{}},a.handleInputChange=a.handleInputChange.bind(Object(P.a)(Object(P.a)(a))),a.mapRef=Object(n.createRef)(),a.markerNameRef=Object(n.createRef)(),a.markerMessageRef=Object(n.createRef)(),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.abortController.signal;navigator.geolocation.getCurrentPosition(function(t){e.setState({location:{lat:t.coords.latitude,lng:t.coords.longitude},zoom:2|e.props.zoom,haveUsersLocation:!0})},function(){fetch("".concat(e.context.hostname,"/location"),{signal:t}).then(function(e){return e.json()}).then(function(t){e.setState({location:{lat:t.data.latitude,lng:t.data.longitude},zoom:10|e.props.zoom,haveUsersLocation:!0})}).catch(function(e){return console.log("Tried to get aproximate location ".concat(e))})})}},{key:"componentWillUnmount",value:function(){this.abortController.abort()}},{key:"handleInputChange",value:function(e){var t=e.target,a=t.value,n=t.name;this.setState(function(e){return{userMessage:Object(d.a)({},e.userMessage,Object(L.a)({},n,a))}})}},{key:"render",value:function(){var e=this,t=[this.state.location.lat,this.state.location.lng],a=[],n=this.props.event&&this.props.event.geos&&this.props.event.geos.length&&this.props.event.geos[0].coords.length||this.props.event&&this.props.event.geos.coords&&this.props.event.geos.coords.length?this.props.event.geos:null;return this.props.event&&n&&!Array.isArray(n)&&(n=[n]),o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"map"},o.a.createElement(B.a,{center:n?n[0].coords:t,zoom:this.state.zoom,style:{height:this.props.heigh||"600px"},ref:this.mapRef,onClick:this.handleClick,scrollWheelZoom:window.innerWidth>650},o.a.createElement(U.a,{attribution:'&copy <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),this.props.enableSearch&&o.a.createElement(Z,{getUserHotelLocation:this.props.getUserHotelLocation||void 0}),this.state.haveUsersLocation&&this.props.editable?o.a.createElement(o.a.Fragment,null,this.state.geos.length&&this.state.geos[0].coords.length?this.state.geos.map(function(t,a){return o.a.createElement(q.a,{onClick:e.onMarkerClick,position:t.coords,icon:Y,key:"".concat(Date.now()+a),id:"".concat(a)},o.a.createElement(H.a,null,t.name))}):o.a.createElement(q.a,{position:t,icon:Y},o.a.createElement(H.a,null,"Init Marker")),this.state.latlng.length?o.a.createElement(q.a,{position:this.state.latlng,icon:Y},o.a.createElement(H.a,null,"Your marker")):null):o.a.createElement(o.a.Fragment,null,n?n.map(function(e,t){return a.push(e.coords),o.a.createElement(q.a,{position:e.coords,icon:0===t?Q:Y,key:t},o.a.createElement(H.a,null,e.name))}):null,o.a.createElement(z.a,{positions:a||[]}))),this.state.haveUsersLocation&&this.props.editable?o.a.createElement("section",{className:"map__form"},o.a.createElement("h3",null,"Add Event Marker"),o.a.createElement("form",{onSubmit:this.formSubmitted},o.a.createElement("label",{htmlFor:"name"},"Marker Name"),o.a.createElement("input",{onChange:this.handleInputChange,ref:this.markerNameRef,type:"text",name:"name",id:"name"}),o.a.createElement("label",{htmlFor:"message"},"Description"),o.a.createElement("input",{onChange:this.handleInputChange,ref:this.markerMessageRef,type:"text",name:"message",id:"message"}),o.a.createElement("button",{type:"submit",className:"btn"},"Attach")),o.a.createElement("button",{onClick:this.onMarkerUpdate,className:"btn"},"Update"),o.a.createElement("button",{onClick:this.onMarkerRemove,className:"btn"},"Remove"),o.a.createElement("button",{onClick:this.onMarkerClearAll,className:"btn"},"Clear All")):o.a.createElement("div",{className:N()({"geo-spinner":this.props.editable,"hide-map":!this.props.editable})},o.a.createElement(F,null))))}}]),t}(n.Component);X.contextType=b;a(127),a(128);var ee=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).body=document.body,a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.body.style.overflowY="hidden",this.body.style.height="100vh",this.body.style.paddingRight="15px"}},{key:"componentWillUnmount",value:function(){this.body.style.overflowY="auto",this.body.style.height="100vh",this.body.style.paddingRight="0"}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"modal-map"},o.a.createElement("a",{className:"__close",href:" #",onClick:function(t){t.preventDefault(),e.props.onClose()}}," "),o.a.createElement("section",null,this.props.children))}}]),t}(n.Component),te=function(e){function t(){var e;return Object(s.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this))).state={isOpen:!1},e.onClose=function(){return e.setState({isOpen:!1})},e.showMap=function(){e.setState({isOpen:!e.state.isOpen})},e.dialogRef=o.a.createRef(),e}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.onClose)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.onClose)}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"modal"},o.a.createElement("header",{className:"modal__header"},o.a.createElement("h1",null,this.props.editable?"Tour Creating":this.props.title),this.props.editable?null:o.a.createElement(o.a.Fragment,null,o.a.createElement("span",null,"Price: US$ ",this.props.event.price),o.a.createElement("span",null,"Start date: ",new Date(this.props.event.date).toLocaleDateString()),o.a.createElement("span",null,"Available Seats: ",this.props.availableSeats||0,"/",this.props.maxSeats||9),this.state.isOpen&&o.a.createElement(o.a.Fragment,null,o.a.createElement(M,null),o.a.createElement(ee,{onClose:this.showMap},o.a.createElement(X,{event:this.props.event,editable:!1,zoom:15}))),o.a.createElement("a",{href:"# ",onClick:function(t){t.preventDefault(),e.showMap()}},o.a.createElement("i",{className:"fa fa-map-marked-alt"})))),o.a.createElement("section",null,this.props.children),o.a.createElement("div",null,o.a.createElement("section",{className:"modal__actions"},this.props.canCancel&&o.a.createElement("button",{className:"btn",onClick:this.props.onCancel},"Cancel"),this.props.canConfirm&&this.props.availableSeats<this.props.maxSeats&&o.a.createElement("button",{className:"btn",onClick:this.props.onConfirm},this.props.confirmText))))}}]),t}(n.Component),ae=a(82),ne=a.n(ae),oe=a(83),re=a.n(oe),ie=a(84),se=a.n(ie),le=(a(129),[se.a,ne.a,re.a]),ce=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={mapIsOpen:!1},a.onClose=function(){a.setState({mapIsOpen:!1})},a.showMap=function(){a.setState({mapIsOpen:!a.state.mapIsOpen})},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.onClose)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.onClose)}},{key:"render",value:function(){var e=this;return o.a.createElement("li",{key:this.props.eventId,className:"events__list-item"},o.a.createElement("div",{className:"events__list-item__img"},o.a.createElement("img",{src:le[this.props.count],alt:"Tour"})),o.a.createElement("div",{className:"events__list-item__content"},o.a.createElement("div",{className:"item__content__header"},this.props.title),o.a.createElement("div",{className:"item__content__price"},this.props.price," USD"),o.a.createElement("div",{className:"item__content__button"},this.props.userInfo.isAdmin?o.a.createElement(o.a.Fragment,null,o.a.createElement("button",{className:"btn",onClick:this.props.onDetail.bind(this,this.props.eventId)},"View/Edit"),o.a.createElement("a",{href:" #",onClick:this.props.onDelete.bind(this,this.props.eventId)},o.a.createElement("i",{className:"fa fa-trash-restore"}))):o.a.createElement("button",{className:"btn",onClick:this.props.onDetail.bind(this,this.props.eventId)},"View Details")),this.state.mapIsOpen&&o.a.createElement(o.a.Fragment,null,o.a.createElement(M,null),o.a.createElement(ee,{onClose:this.showMap},o.a.createElement(X,{event:this.props.event,editable:!1,zoom:8}))),o.a.createElement("a",{className:"__show_route",href:" #",onClick:function(t){t.preventDefault(),e.showMap()}},"show route")),o.a.createElement("div",{className:"events__list-item__botton"},o.a.createElement("div",{className:"item__botton__seats"},"Seats Available: ",this.props.availableSeats,"/",this.props.maxSeats),o.a.createElement("span",null,o.a.createElement("i",{className:"fa fa-calendar"})," Start: ",o.a.createElement("b",null,new Date(this.props.date).toLocaleDateString())),this.props.options?o.a.createElement(o.a.Fragment,null,o.a.createElement("ul",null,this.props.options.map(function(e,t){return o.a.createElement("li",{key:Date.now()+t},o.a.createElement("i",{className:"fa ".concat(e.icon)})," ",e.name,"Duration"===e.name&&e.subtitle&&o.a.createElement("span",null,e.subtitle))}))):null))}}]),t}(n.Component),ue=(a(130),function(e){var t=e.events.map(function(t,a){return o.a.createElement(ce,{count:a,key:t._id,eventId:t._id,event:t,title:t.title,date:t.date,price:t.price,options:t.options,userInfo:e.userInfo,onDetail:e.onViewDetail,availableSeats:t.availableSeats||0,maxSeats:t.maxSeats||9,onDelete:e.onDelete})});return o.a.createElement("ul",{className:"event__list"},t)}),me=(a(131),function(e){return o.a.createElement(o.a.Fragment,null,o.a.createElement("form",null,o.a.createElement("div",{className:"form-control"},o.a.createElement("label",{htmlFor:"title"},"Title"),o.a.createElement("input",{type:"text",id:"title",maxLength:"32",ref:e.titleElRef})),o.a.createElement("div",{className:"form-control"},o.a.createElement("label",{htmlFor:"price"},"Price"),o.a.createElement("input",{type:"number",id:"price",ref:e.priceElRef})),o.a.createElement("div",{className:"form-control"},o.a.createElement("label",{htmlFor:"maxSeats"},"Seats number"),o.a.createElement("input",{type:"number",id:"maxSeats",ref:e.maxSeatsElRef})),o.a.createElement("div",{className:"form-control options"},o.a.createElement("div",{className:"options__list"},o.a.createElement("label",{htmlFor:"options"},"Options",o.a.createElement("em",null,"(for several options press Ctrl)")),o.a.createElement("select",{multiple:!0,id:"options",size:"7",ref:e.optionsElRef,onChange:e.onChange.bind(null,"option")},o.a.createElement("option",{label:"Duration",title:"fa-history"},"9 hours"),o.a.createElement("option",{label:"Instant confirmation",title:"fa-bolt"}),o.a.createElement("option",{label:"Live tour guide",title:"fa-language"},"Turkish, English, German, Russian"),o.a.createElement("option",{label:"Wheelchair accessible",title:"fa-wheelchair"}),o.a.createElement("option",{label:"Pickup included",title:"fa-bus"},"Pickup is from hotels in Side, Turkey. Please meet your guide 5 minutes before your pickup time at the security door to your hotel."),o.a.createElement("option",{label:"Spa",title:"fa-spa"}),o.a.createElement("option",{label:"Swimming pool",title:"fa-swimming-pool"}))),o.a.createElement("div",{className:"options__subtitle"},o.a.createElement("label",{htmlFor:"subtitle"},"Option's subtitle"),o.a.createElement("textarea",{type:"text",id:"subtitle",rows:"7",maxLength:"150",ref:e.subtitleElRef,onChange:e.onChange.bind(null,"subtitle")}))),o.a.createElement("div",{className:"about-activity"},o.a.createElement("div",null,o.a.createElement("fieldset",{ref:e.inclusionsElRef},o.a.createElement("legend",null,"Inclusions"),o.a.createElement("div",null,o.a.createElement("input",{type:"checkbox",id:"pickup",name:"inclusions",value:"pickup"}),o.a.createElement("label",{htmlFor:"pickup"},"Hotel pickup and drop-off")),o.a.createElement("div",null,o.a.createElement("input",{type:"checkbox",id:"lunch",name:"inclusions",value:"lunch"}),o.a.createElement("label",{htmlFor:"lunch"},"Lunch")),o.a.createElement("div",null,o.a.createElement("input",{type:"checkbox",id:"boat",name:"inclusions",value:"boat"}),o.a.createElement("label",{htmlFor:"boat"},"Boat trip")),o.a.createElement("div",null,o.a.createElement("input",{type:"checkbox",id:"guide",name:"inclusions",value:"guide"}),o.a.createElement("label",{htmlFor:"guide"},"Professional tour guide")),o.a.createElement("div",null,o.a.createElement("input",{type:"checkbox",id:"insurance",name:"inclusions",value:"insurance"}),o.a.createElement("label",{htmlFor:"insurance"},"Travel insurance")),o.a.createElement("div",null,o.a.createElement("input",{type:"checkbox",id:"fruits",name:"inclusions",value:"fruits"}),o.a.createElement("label",{htmlFor:"fruits"},"Fruit service")))),o.a.createElement("div",null,o.a.createElement("fieldset",{ref:e.exclusionsElRef},o.a.createElement("legend",null,"Not allowed"),o.a.createElement("div",null,o.a.createElement("input",{type:"checkbox",id:"drinks",name:"exclustions",value:"drinks"}),o.a.createElement("label",{htmlFor:"drinks"},"Drinks")),o.a.createElement("div",null,o.a.createElement("input",{type:"checkbox",id:"fee",name:"exclustions",value:"fee"}),o.a.createElement("label",{htmlFor:"fee"},"Damlatas Cave entrance fee")),o.a.createElement("div",null,o.a.createElement("input",{type:"checkbox",id:"expenses",name:"exclustions",value:"expenses"}),o.a.createElement("label",{htmlFor:"expenses"},"Personal expenses")),o.a.createElement("div",null,o.a.createElement("input",{type:"checkbox",id:"pets",name:"exclustions",value:"pets"}),o.a.createElement("label",{htmlFor:"pets"},"Pets")),o.a.createElement("div",null,o.a.createElement("input",{type:"checkbox",id:"bags",name:"exclustions",value:"bags"}),o.a.createElement("label",{htmlFor:"bags"},"Luggage or large bags")))),o.a.createElement("div",null,o.a.createElement("fieldset",{ref:e.goodToKnowElRef},o.a.createElement("legend",null,"Prepare for the activity"),o.a.createElement("div",null,o.a.createElement("input",{type:"checkbox",id:"passport",name:"good-to-know",value:"passport"}),o.a.createElement("label",{htmlFor:"passport"},"Passport or ID card")),o.a.createElement("div",null,o.a.createElement("input",{type:"checkbox",id:"shoes",name:"good-to-know",value:"shoes"}),o.a.createElement("label",{htmlFor:"shoes"},"Comfortable shoes")),o.a.createElement("div",null,o.a.createElement("input",{type:"checkbox",id:"sunglasses",name:"good-to-know",value:"sunglasses"}),o.a.createElement("label",{htmlFor:"sunglasses"},"Sunglasses")),o.a.createElement("div",null,o.a.createElement("input",{type:"checkbox",id:"sunscreen",name:"good-to-know",value:"sunscreen"}),o.a.createElement("label",{htmlFor:"sunscreen"},"Sunscreen")),o.a.createElement("div",null,o.a.createElement("input",{type:"checkbox",id:"cash",name:"good-to-know",value:"cash"}),o.a.createElement("label",{htmlFor:"cash"},"Cash"))))),o.a.createElement("div",{className:"form-control"},o.a.createElement("label",{htmlFor:"date"},"Date"),o.a.createElement("input",{type:"dateTime-local",id:"date",ref:e.dateElRef})),o.a.createElement("div",{className:"form-control"},o.a.createElement("label",{htmlFor:"description"},"Description"),o.a.createElement("textarea",{type:"text",id:"description",ref:e.descriptionElRef}))))}),de=a(34),pe=a.n(de),he=a(61),fe=a(85),Ee=a.n(fe),ge=a(42),ve=a.n(ge),be=(a(153),function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).onUpload=function(){a.setState({upload:!1,isSuccess:!1})},a.onError=function(){a.setState({withError:!1,isSuccess:!1})},a.event=e.event,a.PREFIX_URL="https://iran-tour-bucket.s3.eu-north-1.amazonaws.com/img/".concat(a.event._id,"/"),a.state={pending:!0,imageBucket:[],upload:!1,isSuccess:!1,withError:!1,file:{},src:"",images:[]},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;ve.a.get("".concat(this.context.hostname,"/file/image-list"),{params:{event:this.event._id}}).then(function(t){var a=t.data.items,n=[];!a.length&&n.push({thumbnail:"https://iran-tour-bucket.s3.eu-north-1.amazonaws.com/img/event1/4v.jpg",original:"https://iran-tour-bucket.s3.eu-north-1.amazonaws.com/img/event1/4v.jpg",embedUrl:"https://www.youtube.com/embed/4pSzhZ76GdM?autoplay=1&showinfo=0",description:"Render custom slides within the gallery"});for(var o=0;o<a.length;o++)n.push({original:"".concat(e.PREFIX_URL).concat(a[o]),thumbnail:"".concat(e.PREFIX_URL).concat(a[o])});e.setState({pending:!1,imageBucket:t.data.items,images:n})}).catch(function(e){return console.log(e)})}},{key:"_onImageClick",value:function(e){console.log("HERE",e.target,"at index",this._imageGallery.getCurrentIndex())}},{key:"onDelete",value:function(){var e=Object(he.a)(pe.a.mark(function e(){var t,a;return pe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.state.images[this._imageGallery.getCurrentIndex()].original,e.prev=1,e.next=4,ve.a.get("".concat(this.context.hostname,"/file/image-delete"),{params:{event:this.event._id,original:t},headers:{Authorization:"Bearer ".concat(document.cookie)},withCredentials:!0,credentials:"include"});case 4:a=e.sent,console.log("Image Successfully deleted: ".concat(a)),a?this.setState({isSuccess:!0}):this.setState({withError:!0}),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),console.log(e.t0),this.setState({withError:!0});case 13:case"end":return e.stop()}},e,this,[[1,9]])}));return function(){return e.apply(this,arguments)}}()},{key:"onChange",value:function(){var e=Object(he.a)(pe.a.mark(function e(t){var a,n=this;return pe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=new FileReader,this.setState({file:t.target.files[0]},function(){a.readAsDataURL(n.state.file)}),a.addEventListener("load",function(e){n.setState({src:e.target.result})}),this.setState({upload:!0});case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onSubmit",value:function(){var e=Object(he.a)(pe.a.mark(function e(t){var a;return pe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),(a=new FormData).append("image",this.state.file),e.prev=3,e.next=6,ve.a.post("".concat(this.context.hostname,"/file/image-upload"),a,{params:{event:this.event._id},headers:{Accept:"multipart/form-data","Content-type":"multipart/form-data",Authorization:"Bearer ".concat(document.cookie)},withCredentials:!0,credentials:"include"});case 6:e.sent?this.setState({isSuccess:!0}):this.setState({withError:!0}),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(3),console.log("error during the upload: ".concat(e.t0.response.data.title)),this.setState({withError:!0});case 14:case"end":return e.stop()}},e,this,[[3,10]])}));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state,a=t.pending,n=t.upload,r=t.images;return o.a.createElement(o.a.Fragment,null,a?o.a.createElement(F,{style:{margin:"34%"}}):o.a.createElement(Ee.a,{ref:function(t){return e._imageGallery=t},lazyLoad:!0,items:r}),this.context.isAdmin?o.a.createElement("div",{className:"file"},n?o.a.createElement("img",{src:this.state.src,className:"file__img",alt:""}):null,o.a.createElement("form",{onSubmit:this.onSubmit.bind(this)},o.a.createElement("label",{className:"file__label",htmlFor:"customFile"},o.a.createElement("i",{className:N()({"fa fa-file-export":!n,"fa fa-file-upload":n})})),n?o.a.createElement("input",{type:"submit",className:"file__upload",id:"customFile"}):o.a.createElement("input",{type:"file",className:"file__input",id:"customFile",onChange:this.onChange.bind(this)})),o.a.createElement("button",{onClick:this.onDelete.bind(this)},o.a.createElement("i",{className:"fa fa-trash-alt"})),this.state.isSuccess&&o.a.createElement(x,{text:"Image was load/delete successfully",duration:2,onClose:this.onUpload}),this.state.withError&&o.a.createElement(x,{error:!0,text:"Loading was failed",duration:3,onClose:this.onError})):o.a.createElement(o.a.Fragment,null))}}]),t}(o.a.Component));be.contextType=b;a(154);var ye=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={isSuccess:!1,hasSent:!1},a.sendEmail=function(e){e.preventDefault();var t=a.nameElRef.current.value,n=a.emailElRef.current.value,o=a.ageElRef.current.value,r=a.countryElRef.current.value,i=a.messageElRef.current.value,s={email:n,subject:a.subjectElRef.current.value,name:t,country:r,gender:a.genderElRef.current.value,age:o,message:i};ve.a.post("".concat(a.context.hostname,"/send"),s,{headers:{Accept:"application/json","Content-Type":"application/json"},credentials:"include"}).then(function(){return a.setState({isSuccess:!0,hasSent:!0,notifyMsg:"Email was sent!"})}).catch(function(e){return a.setState({isSuccess:!1,hasSent:!0,notifyMsg:"Email wasn't sent!"},function(){return new Error(e)})})},a.nameElRef=o.a.createRef(),a.emailElRef=o.a.createRef(),a.ageElRef=o.a.createRef(),a.countryElRef=o.a.createRef(),a.messageElRef=o.a.createRef(),a.subjectElRef=o.a.createRef(),a.genderElRef=o.a.createRef(),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return o.a.createElement(o.a.Fragment,null,this.state.hasSent?o.a.createElement(x,{error:!this.state.isSuccess,text:this.state.notifyMsg,duration:3,onClose:this.props.onClose}):o.a.createElement(o.a.Fragment,null,o.a.createElement(M,null),o.a.createElement("div",{className:"container"},o.a.createElement("div",{className:"wrapper"},o.a.createElement("section",{className:"contact-info"},o.a.createElement("div",{className:"contact-info__header"},o.a.createElement("h1",null,"Contact Info")),o.a.createElement("div",{className:"contact-info__body"},o.a.createElement("ul",null,o.a.createElement("li",null,"first corner St LA"),o.a.createElement("li",null,"aemail@gmail.com"),o.a.createElement("li",null,"(777)-4545-4545")))),o.a.createElement("section",{className:"form"},o.a.createElement("div",{className:"form__header"},o.a.createElement("h3",null,"Email Us")),o.a.createElement("div",{className:"form__body"},o.a.createElement("form",{onSubmit:this.sendEmail},o.a.createElement("div",{className:"form__input"},o.a.createElement("label",{htmlFor:""},"Name"),o.a.createElement("input",{type:"text",ref:this.nameElRef})),o.a.createElement("div",{className:"form__input"},o.a.createElement("label",{htmlFor:""},"Email*"),o.a.createElement("input",{type:"email",name:"email",ref:this.emailElRef,required:!0})),o.a.createElement("div",{className:"form__input"},o.a.createElement("label",{htmlFor:""},"Age"),o.a.createElement("input",{type:"number",ref:this.ageElRef})),o.a.createElement("div",{className:"form__input"},o.a.createElement("label",{htmlFor:""},"Country"),o.a.createElement("input",{type:"text",ref:this.countryElRef})),o.a.createElement("div",{className:"form__input"},o.a.createElement("label",null,"Reason"),o.a.createElement("select",{name:"reason",ref:this.subjectElRef},o.a.createElement("option",{value:"Cost"},"Cost"),o.a.createElement("option",{value:"Secure"},"Secure"),o.a.createElement("option",{value:"Visa"},"Visa"),o.a.createElement("option",{value:"Food"},"Food"),o.a.createElement("option",{value:"Transport"},"Transport"))),o.a.createElement("div",{className:"form__input"},o.a.createElement("label",null,"Gender"),o.a.createElement("select",{name:"gender",ref:this.genderElRef},o.a.createElement("option",{value:"Male"},"Male"),o.a.createElement("option",{value:"Female"},"Female"),o.a.createElement("option",{value:"Other"},"Other"))),o.a.createElement("div",{className:"form__message full"},o.a.createElement("label",{htmlFor:""},"Message*"),o.a.createElement("textarea",{className:"form__message",ref:this.messageElRef,required:!0})),o.a.createElement("div",{className:"form__button full"},o.a.createElement("button",{type:"submit",className:"form__button"},"Submit")))))))))}}]),t}(n.Component);ye.contextType=b;a(155);var ke=["Inclusions","Exclusions","Prepare for the activity"];var Se=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={showPopup:{map:!1,feedBack:!1}},a.cb=function(e){27===e.keyCode&&a.setState({showPopup:{map:!1,feedBack:!1}})},a.onSendForm=function(){a.setState({showPopup:{feedBack:!1}})},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.cb)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.cb)}},{key:"render",value:function(){var e=this;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"tour-container"},o.a.createElement("div",{className:"tour-slider"},o.a.createElement(be,{event:this.props.event})),o.a.createElement("section",{className:"tour-content"},o.a.createElement("div",{className:"see-more-content"},o.a.createElement("p",null,this.props.event.description.split(/<br\s*\/?>/i).reduce(function(e,t,a){var n=o.a.createElement(o.a.Fragment,{key:Date.now()+a},t,o.a.createElement("br",null));return e.concat(n)},[])))),o.a.createElement("article",{className:"tour-sidebar"},o.a.createElement("h2",null,"About this activity"),o.a.createElement("ul",null,this.props.event.options.map(function(e,t){return o.a.createElement("li",{key:Date.now()+t},o.a.createElement("i",{className:"fa ".concat(e.icon)})," ",e.name,e.subtitle&&o.a.createElement(o.a.Fragment,null,o.a.createElement("br",null),o.a.createElement("span",null,e.subtitle)))}))),o.a.createElement("div",{className:"modal__footer"},o.a.createElement("section",{className:"extra-info"},this.props.event.extraInfo.map(function(e,t){return o.a.createElement("details",{key:Date.now()+t},o.a.createElement("summary",null,ke[t]),o.a.createElement("ul",{key:Date.now()+t+1},e.split("&").sort(function(e){return e.match("^!")?1:-1}).map(function(e,t){if(e.match("^!")){var a=e.slice(1).trim();return o.a.createElement("li",{key:Date.now()+t},o.a.createElement("i",{className:"fa fa-times-circle"}),a)}return o.a.createElement("li",{key:Date.now()+t},o.a.createElement("i",{className:"fa fa-check-circle"}),e)})))})),o.a.createElement("h2",null,"Contact the host"),o.a.createElement("div",{className:"contact-host"},o.a.createElement("p",null,"Need more details before you book your trip?"),o.a.createElement("button",{onClick:function(){e.setState({showPopup:{map:!1,feedBack:!0}})}},"Contact the host")),this.state.showPopup.feedBack&&o.a.createElement(o.a.Fragment,null,o.a.createElement(ye,{event:this.props.event,onClose:this.onSendForm})))))}}]),t}(n.Component),Ce=(a(156),function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={creating:!1,events:[],isLoading:!1,selectedEvent:null,geos:[],showMap:!1,isSuccess:!1,withError:!1,notifyMsg:""},a.isActive=!0,a.cb=function(e){27===e.keyCode&&a.setState({selectedEvent:null})},a.startCreateEventHandler=function(){a.setState({creating:!0})},a.onGeoFormSubmit=function(e){e.length&&a.setState({geos:e})},a.extraInfoJoin=function(e){return Object(R.a)(e.current.elements).map(function(e){var t=e.nextSibling;return e.checked?"".concat(t.innerText):"!".concat(t.innerText)}).join("&")},a.formChangeHandler=function(e){"option"===e&&(a.subtitleElRef.current.value=a.optionsElRef.current.selectedOptions[0].value,console.log(a.subtitleElRef.current.value)),"subtitle"===e&&a.optionsElRef.current.selectedOptions.length&&(a.optionsElRef.current.selectedOptions[0].value=a.subtitleElRef.current.value)},a.modalConfirmHandler=function(){a.setState({creating:!1});var e=a.titleElRef.current.value,t=+a.priceElRef.current.value,n=a.dateElRef.current.value,o=a.descriptionElRef.current.value,r=+a.maxSeatsElRef.current.value,i=Object(R.a)(a.optionsElRef.current.selectedOptions),s=i&&i.map(function(e){return{icon:e.title,name:e.label,subtitle:e.value||""}}),l=[a.extraInfoJoin(a.inclusionsElRef),a.extraInfoJoin(a.exclusionsElRef),a.extraInfoJoin(a.goodToKnowElRef)];if(!(0===e.trim().length||t<=0||0===n.trim().length||0===o.trim().lenght)){var c={query:"\n            mutation CreateEvent($title: String!, $description: String!, $price: Float!, $date: String!, $maxSeats: Int, $geos: [GeoInputArgs!]!, $options: [OptionInputArgs!]!, $extraInfo: [String]){\n                createEvent(eventInput: {\n                  title: $title,\n                  description: $description,\n                  price: $price,\n                  date: $date,\n                  geos: $geos,\n                  maxSeats: $maxSeats\n                  options: $options\n                  extraInfo: $extraInfo\n                    }) {\n                  _id\n                  price\n                  date\n                  description\n                  title\n                  maxSeats\n                  availableSeats\n                  geos {\n                    _id\n                    coords\n                    name\n                    message\n                  }\n                  options {\n                      icon\n                      name\n                  }\n                  extraInfo\n                }\n              }",variables:{title:e,description:o,date:n,price:t,maxSeats:r,geos:a.state.geos,options:s,extraInfo:l}};fetch("".concat(a.context.hostname,"/graphql"),{method:"POST",body:JSON.stringify(c),headers:{Accept:"application/json","Content-Type":"application/json",Cookie:"".concat(document.cookie)},credentials:"include"}).then(function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()}).then(function(e){a.setState(function(t){var a=Object(R.a)(t.events);return a.push({_id:e.data.createEvent._id,title:e.data.createEvent.title,price:e.data.createEvent.price,date:e.data.createEvent.date,description:e.data.createEvent.description,maxSeats:e.data.createEvent.maxSeats,availableSeats:e.data.createEvent.availableSeats,geos:e.data.createEvent.geos,options:e.data.createEvent.options,extraInfo:e.data.createEvent.extraInfo}),{events:a,geos:[]}})}).then(function(){return a.setState({isSuccess:!0,notifyMsg:"Tour was successfylly created"})}).catch(function(e){return a.setState({withError:!0,notifyMsg:"Tour wasn't created"}),new Error(e)})}},a.modalCancelHandler=function(){a.setState({creating:!1,selectedEvent:null,geos:[],showMap:!1})},a.showDetailHandler=function(e){a.setState(function(t){return{selectedEvent:t.events.find(function(t){return t._id===e})}})},a.bookEventHandler=function(){if(a.context.token){if(!(a.state.selectedEvent.availableSeats>=a.state.selectedEvent.maxSeats)){var e={query:"\n                    mutation {\n                        bookEvent {\n                            id\n                        }\n                    }"};fetch("".concat(a.context.hostname,"/graphql"),{method:"POST",body:JSON.stringify(e),headers:{Accept:"application/json","Content-Type":"application/json",Cookie:"".concat(document.cookie)},credentials:"include"}).then(function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()}).then(function(t){var n=Object(S.a)(["data","bookEvent","id"],t);n&&(e={query:"\n                            mutation CreateBookingItem($BookItemArgs: CreateBookingItemInput!) {\n                                createBookingItem(input: $BookItemArgs) {\n                                    id\n                                    quantity\n                                }\n                            }\n                        ",variables:{BookItemArgs:{bookingId:n,eventId:a.state.selectedEvent._id,unitPrice:a.state.selectedEvent.price}}},fetch("".concat(a.context.hostname,"/graphql"),{method:"POST",body:JSON.stringify(e),headers:{Accept:"application/json","Content-Type":"application/json",Cookie:"".concat(document.cookie)},credentials:"include"}).then(function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()}).then(function(e){a.isActive&&a.setState({selectedEvent:null,notifyMsg:"The tour was successfully booked",isSuccess:!0})}).catch(function(e){return new Error("Error occured while creating bookingItem ".concat(e))}))}).catch(function(e){throw a.isActive&&a.setState({selectedEvent:null,notifyMsg:"Sorry some error happened",withError:!0}),new Error(e)})}}else a.setState({selectedEvent:null})},a.resetFlags=function(){a.setState({isSuccess:!1,withError:!1,notifyMsg:""})},a.eventRemoveHandler=function(e){if(!e)return new Error("eventId was not passed");console.log(e);var t={query:"mutation RemoveEvent($eventId: ID!) {\n                removeEvent(eventId: $eventId)\n            }",variables:{eventId:e}};fetch("".concat(a.context.hostname,"/graphql"),{method:"POST",body:JSON.stringify(t),headers:{Accept:"application/json","Content-Type":"application/json",Cookie:"".concat(document.cookie)},credentials:"include"}).then(function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()}).then(function(t){console.log(t),a.setState(function(t){return{events:t.events.filter(function(t){return t._id!==e}),isSuccess:!0,notifyMsg:"Event was successfylly deleted"}})}).catch(function(e){return a.setState({withError:!0,notifyMsg:"Event wasn't deleted"}),new Error(e)})},a.showMapHandler=function(){a.setState({showMap:!a.state.showMap})},a.titleElRef=o.a.createRef(),a.priceElRef=o.a.createRef(),a.dateElRef=o.a.createRef(),a.descriptionElRef=o.a.createRef(),a.maxSeatsElRef=o.a.createRef(),a.optionsElRef=o.a.createRef(),a.subtitleElRef=o.a.createRef(),a.inclusionsElRef=o.a.createRef(),a.exclusionsElRef=o.a.createRef(),a.goodToKnowElRef=o.a.createRef(),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.fetchEvents(),document.addEventListener("keydown",this.cb)}},{key:"componentWillUnmount",value:function(){this.isActive=!1,document.removeEventListener("keydown",this.cb)}},{key:"fetchEvents",value:function(){var e=this;this.setState({isLoading:!0});fetch("".concat(this.context.hostname,"/graphql"),{method:"POST",body:JSON.stringify({query:"\n                query {\n                    events {\n                        _id\n                        title\n                        price\n                        date\n                        description\n                        geos {\n                            _id\n                            coords\n                            name\n                            message\n                        }\n                        options {\n                            icon\n                            name\n                            subtitle\n                        }\n                        availableSeats\n                        maxSeats\n                        extraInfo\n                    }\n            }"}),headers:{Accept:"application/json","Content-Type":"application/json",Cookie:"".concat(document.cookie)},credentials:"include"}).then(function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()}).then(function(t){var a=t.data.events.reverse();e.setState({events:a,isLoading:!1})}).catch(function(t){throw e.setState({isLoading:!1}),new Error(t)})}},{key:"render",value:function(){var e=this;return o.a.createElement(o.a.Fragment,null,o.a.createElement("section",{className:"events-container"},(this.state.creating||this.state.selectedEvent)&&o.a.createElement(M,null),this.state.creating&&this.context.isAdmin&&o.a.createElement(te,{title:"Add Tour",canCancel:!0,editable:!0,canConfirm:!0,onCancel:this.modalCancelHandler,onConfirm:this.modalConfirmHandler,confirmText:"Confirm"},o.a.createElement("a",{className:"map-ref",href:"# ",onClick:function(t){t.preventDefault(),e.setState({showMap:!0})}},o.a.createElement("span",null,"Set route")," - on map"),this.state.showMap&&o.a.createElement(o.a.Fragment,null,o.a.createElement(M,null),o.a.createElement(ee,{onClose:this.showMapHandler},o.a.createElement(X,{onFormSubmit:this.onGeoFormSubmit,editable:!0}))),o.a.createElement(me,{onChange:this.formChangeHandler,titleElRef:this.titleElRef,priceElRef:this.priceElRef,dateElRef:this.dateElRef,maxSeatsElRef:this.maxSeatsElRef,descriptionElRef:this.descriptionElRef,optionsElRef:this.optionsElRef,subtitleElRef:this.subtitleElRef,inclusionsElRef:this.inclusionsElRef,exclusionsElRef:this.exclusionsElRef,goodToKnowElRef:this.goodToKnowElRef})),this.state.isSuccess&&o.a.createElement(x,{duration:3,text:this.state.notifyMsg,onClose:this.resetFlags}),this.state.withError&&o.a.createElement(x,{duration:3,text:this.state.notifyMsg,error:!0,onClose:this.resetFlags}),this.state.selectedEvent&&o.a.createElement(te,{title:this.state.selectedEvent.title,availableSeats:this.state.selectedEvent.availableSeats||0,maxSeats:this.state.selectedEvent.maxSeats||9,event:this.state.selectedEvent,confirmText:this.context.token?"Book":"Confirm",canCancel:!0,canConfirm:!0,editable:!1,onCancel:this.modalCancelHandler,onConfirm:this.bookEventHandler.bind()},o.a.createElement(Se,{event:this.state.selectedEvent})),this.context.token&&this.context.isAdmin&&o.a.createElement("div",{className:"sticky_btn"},o.a.createElement("button",{className:"btn",onClick:this.startCreateEventHandler},"Add")),this.state.isLoading?o.a.createElement(F,null):o.a.createElement(ue,{events:this.state.events,userInfo:this.context,onViewDetail:this.showDetailHandler,onDelete:this.eventRemoveHandler})))}}]),t}(n.Component));Ce.contextType=b;var we=Ce,_e=a(25),Ne=a(199),xe=a(194),Ie=a(38),Oe=a(191),je=a(189),Re=a(190),Me=a(196),Fe=a(192),Le=a(57),Pe=a.n(Le),Ae=(a(158),function(e){return o.a.createElement("ul",{className:"booking_items"},e.booking.map(function(t){var a=t.date?Pe()(new Date(+t.date).toUTCString()).utc():void 0;return o.a.createElement("li",{key:t.id,className:"booking_items__item"},o.a.createElement("div",{className:"item__body"},o.a.createElement("h3",null,t.title||t.name),o.a.createElement("div",{className:"item_body__content"},o.a.createElement("p",null,o.a.createElement("span",null,a&&a.format("LLL")),o.a.createElement("span",null,t.quantity," Person")),o.a.createElement("strong",null," $",t.price))),o.a.createElement("div",{className:"item__footer"},o.a.createElement("div",null,o.a.createElement("span",null,"Cancel before ",o.a.createElement("strong",null,a&&a.format("LT"))," on"," ",o.a.createElement("strong",null,a&&a.subtract(1,"days").format("LL"))," ","for a full refund.")),o.a.createElement("div",null,!e.readOnly&&o.a.createElement("a",{href:" #",onClick:e.onChangeQuantity.bind(void 0,[t.id,1])},o.a.createElement("i",{className:"fa fa-plus-circle"})),!e.readOnly&&o.a.createElement("a",{href:" #",onClick:e.onChangeQuantity.bind(void 0,[t.id,-1])},o.a.createElement("i",{className:"fa fa-minus-circle"})),!e.readOnly&&o.a.createElement("a",{href:" #",onClick:e.onDelete.bind(void 0,t.id)},o.a.createElement("i",{className:"fa fa-trash-alt"})))))}))}),Te=a(86),De=(a(171),{Cheap:{min:0,max:50},Normal:{min:50,max:250},Expensive:{min:250,max:1e5}}),Be=function(e){var t=[],a={labels:[],datasets:[]},n=function(n){var o=e.bookings.reduce(function(e,t){return t.price>=De[n].min&&t.price<=De[n].max?e+1:e},0),r="";switch(n){case"Cheap":r="rgba(220,220,220,0.5)";break;case"Normal":r="#3F51B5";break;case"Expensive":r="rgba(255, 69, 12, 0.856)";break;default:r="rgba(220,220,220,0.5)"}a.labels.push(n),t.push(o),a.datasets.push({fillColor:r,strokeColor:"rgba(220,220,220,0.8)",highlightFill:"rgba(220,220,220,0.75)",highlightStroke:"rgba(220,220,220,1)",data:t}),(t=Object(R.a)(t))[t.length-1]=0};for(var r in De)n(r);return o.a.createElement("div",{className:"chartContainer"},o.a.createElement(Te.Bar,{data:a,width:"600",height:"250"}))},Ue=(a(172),function(e){return o.a.createElement("div",{className:"bookings-controls"},o.a.createElement("button",{className:"list"===e.activeOutputType?"active":"",onClick:e.onChange.bind(void 0,"list")},"List"),o.a.createElement("button",{className:"chart"===e.activeOutputType?"active":"",onClick:e.onChange.bind(void 0,"chart")},"Chart"),o.a.createElement("button",{className:"history"===e.activeOutputType?"active":"",onClick:e.onChange.bind(void 0,"history")},"Paid bookings"))}),qe=["Bangladesh","Belgium","Burkina Faso","Bulgaria","Bosnia and Herzegovina","Barbados","Wallis and Futuna","Saint Barthelemy","Bermuda","Brunei","Bolivia","Bahrain","Burundi","Benin","Bhutan","Jamaica","Bouvet Island","Botswana","Samoa","Bonaire, Saint Eustatius and Saba ","Brazil","Bahamas","Jersey","Belarus","Belize","Russia","Rwanda","Serbia","East Timor","Reunion","Turkmenistan","Tajikistan","Romania","Tokelau","Guinea-Bissau","Guam","Guatemala","South Georgia and the South Sandwich Islands","Greece","Equatorial Guinea","Guadeloupe","Japan","Guyana","Guernsey","French Guiana","Georgia","Grenada","United Kingdom","Gabon","El Salvador","Guinea","Gambia","Greenland","Gibraltar","Ghana","Oman","Tunisia","Jordan","Croatia","Haiti","Hungary","Hong Kong","Honduras","Heard Island and McDonald Islands","Venezuela","Puerto Rico","Palestinian Territory","Palau","Portugal","Svalbard and Jan Mayen","Paraguay","Iraq","Panama","French Polynesia","Papua New Guinea","Peru","Pakistan","Philippines","Pitcairn","Poland","Saint Pierre and Miquelon","Zambia","Western Sahara","Estonia","Egypt","South Africa","Ecuador","Italy","Vietnam","Solomon Islands","Ethiopia","Somalia","Zimbabwe","Saudi Arabia","Spain","Eritrea","Montenegro","Moldova","Madagascar","Saint Martin","Morocco","Monaco","Uzbekistan","Myanmar","Mali","Macao","Mongolia","Marshall Islands","Macedonia","Mauritius","Malta","Malawi","Maldives","Martinique","Northern Mariana Islands","Montserrat","Mauritania","Isle of Man","Uganda","Tanzania","Malaysia","Mexico","Israel","France","British Indian Ocean Territory","Saint Helena","Finland","Fiji","Falkland Islands","Micronesia","Faroe Islands","Nicaragua","Netherlands","Norway","Namibia","Vanuatu","New Caledonia","Niger","Norfolk Island","Nigeria","New Zealand","Nepal","Nauru","Niue","Cook Islands","Kosovo","Ivory Coast","Switzerland","Colombia","China","Cameroon","Chile","Cocos Islands","Canada","Republic of the Congo","Central African Republic","Democratic Republic of the Congo","Czech Republic","Cyprus","Christmas Island","Costa Rica","Curacao","Cape Verde","Cuba","Swaziland","Syria","Sint Maarten","Kyrgyzstan","Kenya","South Sudan","Suriname","Kiribati","Cambodia","Saint Kitts and Nevis","Comoros","Sao Tome and Principe","Slovakia","South Korea","Slovenia","North Korea","Kuwait","Senegal","San Marino","Sierra Leone","Seychelles","Kazakhstan","Cayman Islands","Singapore","Sweden","Sudan","Dominican Republic","Dominica","Djibouti","Denmark","British Virgin Islands","Germany","Yemen","Algeria","United States","Uruguay","Mayotte","United States Minor Outlying Islands","Lebanon","Saint Lucia","Laos","Tuvalu","Taiwan","Trinidad and Tobago","Turkey","Sri Lanka","Liechtenstein","Latvia","Tonga","Lithuania","Luxembourg","Liberia","Lesotho","Thailand","French Southern Territories","Togo","Chad","Turks and Caicos Islands","Libya","Vatican","Saint Vincent and the Grenadines","United Arab Emirates","Andorra","Antigua and Barbuda","Afghanistan","Anguilla","U.S. Virgin Islands","Iceland","Iran","Armenia","Albania","Angola","Antarctica","American Samoa","Argentina","Australia","Austria","Aruba","India","Aland Islands","Azerbaijan","Ireland","Indonesia","Ukraine","Qatar","Mozambique"],He=(a(173),function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).telRegex="^[+]*[(]{0,1}[0-9]{1,4}[)]{0,1}[-/0-9]*$",a.billDetailsHandler=function(e){e.target.classList.add("validate"),e.target.validity.valid?(e.target.nextElementSibling.classList.add("validation_success"),e.target.nextElementSibling.classList.remove("validation_error"),e.target.nextElementSibling.innerHTML="",a.props.handleChange(e.target.name)(e.target.value)):(e.target.nextElementSibling.classList.remove("validation_success"),e.target.nextElementSibling.classList.add("validation_error"),e.target.nextElementSibling.innerHTML=e.target.validationMessage);var t=Object(R.a)(a.billDetailsRef.current.elements);t.some(function(e){return!e.validity.valid})?t.forEach(function(e){e.classList.add("validate"),a.props.handleChange("isValidPersonalInfo")(!1)}):a.props.handleChange("isValidPersonalInfo")(!0)},a.props=e,a.billDetailsRef=o.a.createRef(),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.values;return o.a.createElement(o.a.Fragment,null,o.a.createElement("fieldset",{className:"billing_details",ref:this.billDetailsRef},o.a.createElement("legend",null,"Personal details"),o.a.createElement("p",{className:"form-row"},o.a.createElement("label",{htmlFor:"firstName"},"First name *"),o.a.createElement("input",{type:"text",id:"firstName",name:"firstName",maxLength:"45",defaultValue:e.firstName,onInput:this.billDetailsHandler,required:!0}),o.a.createElement("span",{"aria-live":"polite"})),o.a.createElement("p",{className:"form-row"},o.a.createElement("label",{htmlFor:"lastName"},"Last name *"),o.a.createElement("input",{type:"text",id:"lastName",name:"lastName",maxLength:"45",defaultValue:e.lastName,onInput:this.billDetailsHandler,required:!0}),o.a.createElement("span",{"aria-live":"polite"})),o.a.createElement("p",{className:"form-row"},o.a.createElement("label",{htmlFor:"clientEmail"},"Email *"),o.a.createElement("input",{type:"email",id:"clientEmail",name:"clientEmail",maxLength:"255",defaultValue:e.clientEmail,onInput:this.billDetailsHandler,required:!0}),o.a.createElement("span",{"aria-live":"polite"})),o.a.createElement("p",{className:"form-row"},o.a.createElement("label",{htmlFor:"country"},"Country *"),o.a.createElement("input",{list:"countries",id:"country",name:"country",defaultValue:e.country,onChange:this.billDetailsHandler,required:!0}),o.a.createElement("span",{"aria-live":"polite"}),o.a.createElement("datalist",{id:"countries"},qe.map(function(e){return o.a.createElement("option",{key:e,value:e})}))),o.a.createElement("p",{className:"form-row"},o.a.createElement("label",{htmlFor:"mobilePhone"},"Mobile phone *"),o.a.createElement("input",{type:"tel",id:"mobilePhone",name:"mobilePhone",defaultValue:e.mobilePhone,maxLength:"20",onInput:this.billDetailsHandler,placeholder:"e.g. +43 (0)288 234 534",pattern:this.telRegex,required:!0}),o.a.createElement("span",{"aria-live":"polite"}))))}}]),t}(n.Component));a(174);function ze(e){return o.a.createElement("div",{className:"total__buttons"},e.children)}var $e=function(e){var t=Object(n.useState)(!1),a=Object(_e.a)(t,2),r=a[0],i=a[1],s=Object(n.useState)(e.total_cost),l=Object(_e.a)(s,2),c=l[0],u=l[1];return Object(n.useEffect)(function(){c!==e.total_cost&&(i(!0),setTimeout(function(){i(!1)},1e3),u(e.total_cost))},[e.total_cost]),o.a.createElement("article",{className:"total bill_details_article",style:{background:e.bg_color}},o.a.createElement("div",{className:"total__cost"},o.a.createElement("span",null,"Total (",e.events.length," items)"),o.a.createElement("strong",{className:N()({"total-changed":r})},"US$",e.total_cost)),o.a.createElement("p",{className:"total__gasoline"},e.includeGas?"Including gasoline":"Excluding gasoline"),e.children)};a(175);function Ge(e){var t=e.values,a=t.firstName,n=t.lastName,r=t.clientEmail,i=t.country,s=t.mobilePhone,l=t.address;return o.a.createElement(o.a.Fragment,null,o.a.createElement("h2",null,"Please confirm the specified data"),o.a.createElement("ul",{className:"booking_items confirm_list"},o.a.createElement("li",null,o.a.createElement("strong",null,"First Name"),o.a.createElement("span",null,a)),o.a.createElement("li",null,o.a.createElement("strong",null,"Last Name"),o.a.createElement("span",null,n)),o.a.createElement("li",null,o.a.createElement("strong",null,"Email"),o.a.createElement("span",null,r)),o.a.createElement("li",null,o.a.createElement("strong",null,"Country"),o.a.createElement("span",null,i)),o.a.createElement("li",null,o.a.createElement("strong",null,"Phone"),o.a.createElement("span",null,s)),o.a.createElement("li",null,o.a.createElement("strong",null,"Hotel Address"),o.a.createElement("span",null,l))))}a(176);var Ve=function(){return o.a.createElement("div",{className:"content-secondary"},o.a.createElement("div",{className:"trust-block accept"},o.a.createElement("h4",{className:"trust-block-title"},"You can pay with:"),o.a.createElement("ul",{className:"payment-methods"},o.a.createElement("li",{className:"payment-method paypal available",title:"PayPal"}),o.a.createElement("li",{className:"payment-method mastercard available",title:"MasterCard"}),o.a.createElement("li",{className:"payment-method visa available",title:"VISA"}),o.a.createElement("li",{className:"payment-method maestro available",title:"Maestro"}),o.a.createElement("li",{className:"payment-method jcb  available",title:"JCB"}))),o.a.createElement("div",{className:"trust-block security-gyg"},o.a.createElement("h4",{className:"trust-block-title"},"Data Security"),o.a.createElement("div",{className:"trust-block-lock icon-lock"},o.a.createElement("p",{className:"security-gyg__item first"},"Your info's safe with us. All data is",o.a.createElement("strong",null," encrypted and transmitted securely "),"with an SSL protocol."))),o.a.createElement("div",{className:"trust-block why-gyg"},o.a.createElement("h4",{className:"trust-block-title"},"Book with confidence"),o.a.createElement("div",{className:"trust-block-checkmark"},o.a.createElement("p",{className:"why-gyg-item first"},o.a.createElement("strong",null,"Best price guarantee. "),"Found your activity for less? We'll refund the difference."),o.a.createElement("p",{className:"why-gyg-item subsequent"},o.a.createElement("strong",null,"Peace of mind. "),"Book ahead to skip the lines and reserve your spot."))))},Je=(a(177),function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).handleChange=function(e){console.log(e)},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"payment_form_elements"},o.a.createElement("label",null,"Card number",o.a.createElement(k.CardNumberElement,null)),o.a.createElement("label",null,"Expiration date",o.a.createElement(k.CardExpiryElement,null)),o.a.createElement("label",null,"CVC",o.a.createElement(k.CardCvcElement,null))))}}]),t}(o.a.Component)),Ke=a(204),We=(a(178),function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).state=Object(d.a)({isRedirect:!1,status:{succeeded:!1,failed:!1,pending:!1},isInvalidForm:!1,error_message:""},a.props.values.values),a.handleSubmit=function(e){e.preventDefault(),a.props.stripe.createToken({type:"card",name:a.state.firstName}).then(function(e){var t=e.token;return a.setState({token:t.id})}).catch(function(e){return console.log(e)}),a.props.stripe.createPaymentMethod("card",{billing_details:{name:a.state.firstName}}).then(function(e){var t=e.paymentMethod.card;a.onPaymentCheck(t)}).catch(function(e){return console.log(e)})},a.onPaymentCheck=function(){var e={firstName:a.state.firstName,lastName:a.state.lastName,country:a.state.country,residence:a.state.address||"",clientEmail:a.state.clientEmail,mobilePhone:a.state.mobilePhone},t=Object(Ie.a)(function(e){return{id:e._id,quantity:e.quantity}})(a.state.events),n={query:"\n            mutation CreatePayment($PaymentInputArgs: PaymentInputArgs! ){\n                createPayment(paymentInput: $PaymentInputArgs) {\n                  id\n                  paid\n                  status\n                }\n              }",variables:{PaymentInputArgs:{token:a.state.token,total:100*a.state.total_cost,eventsIds:t}}};fetch("".concat(a.context.hostname,"/graphql"),{method:"POST",body:JSON.stringify(n),headers:{Accept:"application/json","Content-Type":"application/json",Cookie:"".concat(document.cookie)},credentials:"include"}).then(function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()}).then(function(e){if(e.errors){a.setState({isInvalidForm:!0,error_message:e.errors[0].message});var t=Object(Ke.a)([e.errors[0].message],["extensions","exception","invalidArgs"],e.errors[0]);return a.setState({error_message:t[0],isInvalidForm:!0}),new Error(e.errors[0].message)}return e}).then(function(t){var o=t.data.createPayment,r=o.id,i=o.paid,s=o.status;i&&(n={query:"\n                            mutation CreateOrUpdateCustomer($CustomerInput: CustomerInput!) {\n                                createOrUpdateCustomer(customerInput: $CustomerInput)\n                            }\n                        ",variables:{CustomerInput:Object(d.a)({},e,{lastPaymentId:r,lastBill:a.state.total_cost,lastBookingId:a.state.bookingId,lastPaymentStatus:s})}},fetch("".concat(a.context.hostname,"/graphql"),{method:"POST",body:JSON.stringify(n),headers:{Accept:"application/json","Content-Type":"application/json",Cookie:"".concat(document.cookie)},credentials:"include"}).then(function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()}).then(function(e){a.setState({status:Object(L.a)({},s,!0),isInvalidForm:!1})}).catch(function(e){return"Customer: ".concat(e)}))}).catch(function(e){return"From Server: ".concat(e)})},a.props=e,a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.state,a=t.status,n=a.succeeded,r=a.pending,i=a.failed,s=t.isInvalidForm,l=t.error_message;return o.a.createElement(o.a.Fragment,null,o.a.createElement("form",{onSubmit:this.handleSubmit,className:"payment_stripe_form"},o.a.createElement(Je,null),o.a.createElement("button",null,"Confirm order")),s&&o.a.createElement(x,{text:l,error:!0,duration:"4",onClose:function(){e.setState({isInvalidForm:!1})}}),o.a.createElement(o.a.Fragment,null,n||r||i?o.a.createElement(o.a.Fragment,null,o.a.createElement(x,{text:i?"Payment declined":"Payment was successful.\nDetailed information was sent to your email",error:i,success:n||r,duration:"3",onClose:function(){e.setState({isRedirect:!0})}}),this.state.isRedirect&&o.a.createElement(f.a,{to:"/events"})):null))}}]),t}(o.a.Component));We.contextType=b;var Ze=Object(k.injectStripe)(We),Ye=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return o.a.createElement(k.Elements,null,o.a.createElement(Ze,{values:this.props}))}}]),t}(o.a.Component),Qe=(a(179),a(188)),Xe=a(193),et=a(205),tt=(a(180),function(e){return o.a.createElement("ul",{className:"booking_history_items"},e.booking.map(function(e){var t=e.date?Pe()(new Date(+e.date).toUTCString()).utc():void 0;return o.a.createElement("li",{key:e.id,className:"booking_history_items__item"},o.a.createElement("div",{className:"history_item__body"},o.a.createElement("h3",null,e.title||e.name),o.a.createElement("div",{className:"history_item_body__content"},o.a.createElement("p",null,o.a.createElement("span",null,t&&t.format("LLL")),o.a.createElement("span",null,e.quantity," Person")),o.a.createElement("strong",null," $",e.price))))}))}),at=(a(181),function(){var e=Object(n.useContext)(b),t=Object(n.useState)(!0),a=Object(_e.a)(t,2),r=a[0],i=a[1],s=Object(n.useState)(!1),l=Object(_e.a)(s,2),c=l[0],u=l[1],m=Object(n.useState)(null),d=Object(_e.a)(m,2),p=d[0],h=d[1];return Object(n.useEffect)(function(){fetch("".concat(e.hostname,"/graphql"),{method:"POST",body:JSON.stringify({query:"\n                query {\n                    paidBookingsByUserId {\n                        id\n                        completed\n                        cost\n                        updatedAt\n                        events {\n                           id\n                           quantity\n                           eventId {\n                               _id\n                               title\n                               date\n                               price\n                           }\n                        }\n                    }\n            }"}),headers:{Accept:"application/json","Content-Type":"application/json",Cookie:"".concat(document.cookie)},credentials:"include"}).then(function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()}).then(function(e){var t=Object(S.a)(["data","paidBookingsByUserId"],e);if(!t)return u(!0),void i(!1);var a=function(e){return Object(Qe.a)(Object(je.a)("eventId",e),Object(Re.a)(["eventId"],e))},n=Object(Ie.a)(Object(Xe.a)(function(e){return Object(Ie.a)(a,e)},function(e){return e.events}),t),o=Object(et.a)(Ie.a)(function(e,t){return e.events=n[t],e})(t);h(o),i(!1)}).catch(function(e){return new Error(e)})},[]),o.a.createElement(o.a.Fragment,null,o.a.createElement("section",{className:"history_list"},r&&o.a.createElement(F,null),!r&&c&&o.a.createElement("h1",null,"You have not paid any bookings yet"),!r&&!c&&p.map(function(e){return o.a.createElement("div",{className:"history_total",key:e.id},o.a.createElement("h3",null,"Total: ",e.cost),o.a.createElement("p",null,"Paid: ",new Date(e.updatedAt).toUTCString()),o.a.createElement(tt,{booking:e.events}))})))});var nt=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={events:[],bookingId:"",hotels:[],isLoading:!1,outputType:"list",total_cost:0,paid_distance:0,step:1,back:!1,next:!1,billDetails:null,firstName:"",lastName:"",clientEmail:"",country:"",mobilePhone:"",isValidPersonalInfo:!1,isValidResidenceInfo:!1,user_residence:{label:"",coords:[]},warning_message:""},a.getPaidDistance=function(e,t){var n=t.user_residence;if(a.state.events){var o=a.state.events.reduce(function(e,t){if(t.geos[0]&&t.geos[0].coords&&t.geos[0].coords.length){var o=t.geos[0].coords;return e+a.getDistance(o,n.coords)}return e},0);o=Math.floor(o/100*12*1.181),a.setState({paid_distance:o,total_cost:o+e,user_residence:n,isValidResidenceInfo:!0})}},a.getDistance=function(e,t){var a=e[0]*(Math.PI/180),n=e[1]*(Math.PI/180),o=t[0]*(Math.PI/180),r=t[1]*(Math.PI/180)-n,i=Math.sqrt(Math.pow(Math.cos(o)*Math.sin(r),2)+Math.pow(Math.cos(a)*Math.sin(o)-Math.sin(a)*Math.cos(o)*Math.cos(r),2)),s=Math.sin(a)*Math.sin(o)+Math.cos(a)*Math.cos(o)*Math.cos(r);return 6371.0087714*Math.atan2(i,s)},a.eventQuantityHandler=function(e){var t=Object(_e.a)(e,2),n=t[0],o=t[1];if(n&&o&&a.state.events.length){var r=Object(Ne.a)(Object(xe.a)("id",n))(a.state.events);if(1===r.quantity&&-1===o)return a.deleteBookingHandler(n);var i=r.quantity*r.price;o+=r.quantity,function(e){return fetch("https://turkish-tours.online:5000",{method:"POST",body:JSON.stringify(e),headers:{Accept:"application/json","Content-Type":"application/json",Cookie:"".concat(document.cookie)},credentials:"include"})}({query:"\n                mutation UpdateBookingItem($UpdateBookingItemInput: UpdateBookingItemInput!) {\n                    updateBookingItem(input: $UpdateBookingItemInput) {\n                        quantity\n                    }\n                }\n            ",variables:{UpdateBookingItemInput:{id:n,quantity:o}}}).then(function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()}).then(function(e){if(e){var t=Object(S.a)(["data","updateBookingItem","quantity"],e),o=a.state.total_cost-i+t*r.price;a.setState(function(e){return{events:Object(Ie.a)(function(e){return e.id===n?(e.quantity=t,e):e})(e.events),total_cost:o}})}}).catch(function(e){return new Error(e)})}},a.deleteBookingHandler=function(e){if(e){var t={query:"\n                mutation DeleteBookingItem($bookingItemId: ID!) {\n                    deleteBookingItem(bookingItemId: $bookingItemId) {\n                        unitPrice\n                        quantity\n                    }\n            }",variables:{bookingItemId:e}};fetch("".concat(a.context.hostname,"/graphql"),{method:"POST",body:JSON.stringify(t),headers:{Accept:"application/json","Content-Type":"application/json",Cookie:"".concat(document.cookie)},credentials:"include"}).then(function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()}).then(function(t){if(console.log(t),t){var n=Object(S.a)(["data","deleteBookingItem"],t),o=n.quantity,r=n.unitPrice;a.setState(function(t){return{events:t.events.filter(function(t){return t.id!==e}),total_cost:t.total_cost-o*r}})}}).catch(function(e){throw a.setState({isLoading:!1}),new Error(e)})}},a.outPutTypeSwitcher=function(e){e&&a.setState({outputType:e})},a.nextStep=function(){var e=a.state.step;a.setState({step:e+1,next:!0,back:!1})},a.prevStep=function(){var e=a.state.step;a.setState({step:e-1,back:!0,next:!1})},a.getUserHotelLocation=function(e){e&&e.fullLocationInfo.then(function(t){if("TUR"!==t.address.CountryCode)return a.setState({isValidResidenceInfo:!1,warning_message:"Please select location from Turkey area"});var n=a.state.paid_distance?a.state.total_cost-a.state.paid_distance:a.state.total_cost;a.getPaidDistance(n,{user_residence:{label:e.label,coords:e.coords}})}).catch(function(e){console.log(e),a.setState({isValidResidenceInfo:!1,warning_message:e.details&&e.details[0]})})},a.handleChange=function(e){return function(t){a.setState(Object(L.a)({},e,t))}},a.props=e,a.billDetailsRef=o.a.createRef(),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.fetchBooks()}},{key:"fetchBooks",value:function(){var e=this;this.setState({isLoading:!0});fetch("".concat(this.context.hostname,"/graphql"),{method:"POST",body:JSON.stringify({query:"\n                query {\n                    bookingsByUserId {\n                        id\n                        completed\n                        events {\n                           id\n                           quantity\n                           eventId {\n                               _id\n                               title\n                               date\n                               price\n                               geos {\n                                   coords\n                               }\n                           }\n                        }\n                    }\n            }"}),headers:{Accept:"application/json","Content-Type":"application/json",Cookie:"".concat(document.cookie)},credentials:"include"}).then(function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()}).catch(function(e){return"From Server: ".concat(e)}).then(function(t){var a=Object(S.a)(["data","bookingsByUserId"],t),n=a?Object(Ne.a)(function(e){return!e.completed})(a):void 0;if(a.length&&n&&n.events){var o=Object(Me.a)(function(e){return Object(Oe.a)(Object(je.a)("eventId",e),Object(Re.a)(["eventId"],e))},n.events),r=0;o.forEach(function(e){e.price&&(r+=Object(Fe.a)(e.quantity,e.price))}),e.setState({events:o,total_cost:r,isLoading:!1,bookingId:n.id})}else e.setState({events:[],hotels:[],isLoading:!1})}).catch(function(t){throw e.setState({isLoading:!1}),new Error("On client ".concat(t))})}},{key:"render",value:function(){var e=this,t=this.state.step,a=this.state,n={firstName:a.firstName,lastName:a.lastName,clientEmail:a.clientEmail,country:a.country,mobilePhone:a.mobilePhone,address:a.user_residence.label,total_cost:a.total_cost,bookingId:a.bookingId,events:a.events};switch(t){case 1:return this.state.isLoading?o.a.createElement(F,null):o.a.createElement(o.a.Fragment,null,o.a.createElement("section",{className:N()({booking_container:!0,next:this.state.next,back:this.state.back})},o.a.createElement("div",{className:"booking_list"},o.a.createElement(Ue,{activeOutputType:this.state.outputType,onChange:this.outPutTypeSwitcher}),o.a.createElement("div",null,"list"===this.state.outputType&&o.a.createElement(Ae,{booking:this.state.events,onDelete:this.deleteBookingHandler,onChangeQuantity:this.eventQuantityHandler}),"chart"===this.state.outputType&&o.a.createElement(Be,{bookings:this.state.events}),"history"===this.state.outputType&&o.a.createElement(at,null))),o.a.createElement($e,{events:this.state.events,total_cost:this.state.total_cost},o.a.createElement(ze,null,o.a.createElement("button",{className:"btn checkout_btn",onClick:this.nextStep,disabled:!this.state.events.length},"Next"),o.a.createElement(v.a,{to:"/events",className:"btn checkout_btn see_more"},"See more activities")))));case 2:return o.a.createElement("section",{className:N()({booking_container:!0,next:this.state.next,back:this.state.back})},o.a.createElement("div",{className:"booking_list"},o.a.createElement(He,{handleChange:this.handleChange,values:n})),o.a.createElement($e,{events:this.state.events,total_cost:this.state.total_cost,nextStep:this.nextStep,prevStep:this.prevStep,disabled:!this.state.isValidPersonalInfo},o.a.createElement(Ae,{booking:this.state.events,readOnly:!0}),o.a.createElement(ze,null,o.a.createElement("button",{className:"btn checkout_btn",onClick:this.nextStep,disabled:!this.state.isValidPersonalInfo},"Next"),o.a.createElement("a",{href:" #",className:"btn checkout_btn see_more",onClick:this.prevStep},"Back"))));case 3:return o.a.createElement("section",{className:N()({booking_container:!0,next:this.state.next,back:this.state.back})},o.a.createElement("div",{className:"booking_list"},o.a.createElement("h2",null,"Information requested by the local partner"),o.a.createElement("br",null),o.a.createElement("h3",null,"We need the address of your accommodation in order to arrange pickup."),o.a.createElement("div",{className:"user_hotel"},o.a.createElement(X,{heigh:"400px",getUserHotelLocation:this.getUserHotelLocation,enableSearch:!0}))),this.state.warning_message&&o.a.createElement(x,{text:this.state.warning_message,warning:!0,duration:4,onClose:function(){e.setState({warning_message:""})}}),o.a.createElement($e,{events:this.state.events,total_cost:this.state.total_cost,nextStep:this.nextStep,prevStep:this.prevStep,includeGas:!0},o.a.createElement(Ae,{booking:this.state.events,readOnly:!0}),o.a.createElement(ze,null,o.a.createElement("button",{className:"btn checkout_btn",onClick:this.nextStep,disabled:!this.state.isValidResidenceInfo},"Next"),o.a.createElement("a",{href:" #",className:"btn checkout_btn see_more",onClick:this.prevStep},"Back"))));case 4:return o.a.createElement("section",{className:N()({booking_container:!0,next:this.state.next,back:this.state.back})},o.a.createElement("div",{className:"booking_list"},o.a.createElement(Ge,{values:n})),o.a.createElement($e,{events:this.state.events,total_cost:this.state.total_cost,nextStep:this.nextStep,prevStep:this.prevStep,includeGas:!0},o.a.createElement(Ae,{booking:this.state.events,readOnly:!0}),o.a.createElement(ze,null,o.a.createElement("button",{className:"btn checkout_btn",onClick:this.nextStep,disabled:!this.state.isValidPersonalInfo||!this.state.isValidResidenceInfo},"Confirm & Pay"),o.a.createElement("a",{href:" #",className:"btn checkout_btn see_more",onClick:this.prevStep},"Back"))));case 5:return o.a.createElement("section",{className:N()({booking_container:!0,next:this.state.next,back:this.state.back})},o.a.createElement("div",{className:"booking_list"},o.a.createElement(Ye,{values:n})),o.a.createElement($e,{bg_color:"#f3f4f6",events:this.state.events,total_cost:this.state.total_cost,nextStep:this.nextStep,prevStep:this.prevStep,includeGas:!0},o.a.createElement(ze,null,o.a.createElement(Ve,null))));default:return}}}]),t}(n.Component);nt.contextType=b;var ot=nt,rt=(a(182),"localhost1"===window.location.hostname?"http://localhost:4000":"https://turkish-tours.online:5000"),it=new RegExp(/("(\\.|[^"])*"|\[|\]|,|\d+|\{|\}|[a-zA-Z0-9_]+)/g);function st(e){!function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(a=Object(d.a)({path:"/"},a)).expires&&a.expires.toUTCString&&(a.expires=a.expires.toUTCString());var n=encodeURIComponent(e)+"="+encodeURIComponent(t);for(var o in a){n+="; "+o;var r=a[o];!0!==r&&(n+="="+r)}document.cookie=n}(e,"",{"max-age":-1})}var lt=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={token:void 0,isAdmin:!1,userId:null},a.getUser=function(e){var t=e.match(it)[1],a=JSON.parse(atob(t));return a.isAdmin="admin"===a["cognito:groups"][0],a},a.login=function(e){var t=a.getUser(e);a.setState({token:e,userId:t.sub,isAdmin:t.isAdmin}),localStorage.setItem("token",e)},a.logout=function(){fetch("".concat(rt,"/graphql"),{method:"POST",body:JSON.stringify({query:"\n        mutation {\n          logout\n        }"}),headers:{Accept:"application/json","Content-Type":"application/json",Cookie:"".concat(document.cookie)},credentials:"include"}).then(function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()}).then(function(e){var t=e.data.logout;(t||null===t)&&(a.setState({token:null,userId:null}),localStorage.removeItem("token"),st("access-token"),st("refresh-token"))}).catch(function(e){console.log("FAILED"),console.log(e)})},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=localStorage.getItem("token");if(e){var t=this.getUser(e);this.setState({token:e,userId:t.sub,isAdmin:t.isAdmin})}}},{key:"render",value:function(){return o.a.createElement(k.StripeProvider,{apiKey:"pk_test_4GBYsitSDwJ20srHk9Qr0F8q00LKrBd3gE"},o.a.createElement(p.a,null,o.a.createElement(o.a.Fragment,null,o.a.createElement(b.Provider,{value:{token:this.state.token,userId:this.state.userId,isAdmin:this.state.isAdmin,login:this.login,logout:this.logout,hostname:rt,stripe_pub_key:"pk_test_4GBYsitSDwJ20srHk9Qr0F8q00LKrBd3gE"}},o.a.createElement(y,null),o.a.createElement("main",{className:"main-content"},o.a.createElement(h.a,null,!this.state.token&&o.a.createElement(f.a,{from:"/bookings",to:"/auth",exact:!0}),o.a.createElement(f.a,{from:"/",to:"/events",exact:!0}),this.state.token&&o.a.createElement(f.a,{from:"/",to:"/events",exact:!0}),this.state.token&&o.a.createElement(f.a,{from:"/auth",to:"/events",exact:!0}),!this.state.token&&o.a.createElement(E.a,{path:"/auth",component:j}),o.a.createElement(E.a,{path:"/events",component:we}),this.state.token&&o.a.createElement(E.a,{path:"/bookings",component:ot}),!this.state.token&&o.a.createElement(f.a,{to:"/auth",exact:!0})))))))}}]),t}(n.Component);i.a.render(o.a.createElement(lt,null),document.getElementById("root"))},52:function(e,t,a){e.exports=a.p+"static/media/initPointIcon.5221c1ff.svg"},70:function(e,t,a){e.exports=a.p+"static/media/pointIcon.7c9810df.svg"},82:function(e,t,a){e.exports=a.p+"static/media/t2.c2210c6f.jpg"},83:function(e,t,a){e.exports=a.p+"static/media/t1.f06e4f93.jpg"},84:function(e,t,a){e.exports=a.p+"static/media/t3.95688681.jpg"},89:function(e,t,a){e.exports=a(183)},94:function(e,t,a){},95:function(e,t,a){}},[[89,1,2]]]);
//# sourceMappingURL=main.d6130ade.chunk.js.map